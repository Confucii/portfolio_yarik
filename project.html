<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Project details">
  <title id="page-title">Project - Yarik's Portfolio</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <!-- Header -->
  <header>
    <nav class="container">
      <div class="logo">
        <img src="/public/logo.svg" alt="Logo" id="logo-img">
        <span>Portfolio</span>
      </div>
      <button class="menu-toggle" aria-label="Toggle menu">☰</button>
      <ul class="nav-links">
        <li><a href="/">Home</a></li>
        <li><a href="/about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <!-- Project Header -->
  <section class="hero" style="min-height: 40vh;">
    <div class="container">
      <h1 id="project-title">Loading...</h1>
      <p id="project-description"></p>
      <div style="margin-top: var(--spacing-md);">
        <a href="#" id="back-link" class="btn">← Back to Category</a>
      </div>
    </div>
  </section>

  <!-- Gallery -->
  <section class="gallery">
    <div class="container">
      <h2 class="section-title">Gallery</h2>
      <div class="gallery-grid" id="gallery-grid">
        <div class="loading">Loading images...</div>
      </div>
    </div>
  </section>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" aria-label="Close">&times;</button>
    <button class="lightbox-prev" aria-label="Previous">‹</button>
    <button class="lightbox-next" aria-label="Next">›</button>
    <div class="lightbox-content">
      <img src="" alt="" id="lightbox-img">
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; <span id="year"></span> Yarik. All rights reserved.</p>
    </div>
  </footer>

  <script type="module">
    // Mobile menu toggle
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('.nav-links');

    menuToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active');
    });

    // Get project ID and category from URL
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get('id');
    const categoryName = urlParams.get('category');

    if (!projectId || !categoryName) {
      window.location.href = '/';
    }

    // Update back link
    document.getElementById('back-link').href = `/category.html?name=${encodeURIComponent(categoryName)}`;

    // Lightbox functionality
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    let currentImages = [];
    let currentIndex = 0;

    function openLightbox(index) {
      currentIndex = index;
      lightboxImg.src = currentImages[currentIndex];
      lightbox.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      lightbox.classList.remove('active');
      document.body.style.overflow = '';
    }

    function showPrevious() {
      currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
      lightboxImg.src = currentImages[currentIndex];
    }

    function showNext() {
      currentIndex = (currentIndex + 1) % currentImages.length;
      lightboxImg.src = currentImages[currentIndex];
    }

    // Lightbox event listeners
    document.querySelector('.lightbox-close').addEventListener('click', closeLightbox);
    document.querySelector('.lightbox-prev').addEventListener('click', showPrevious);
    document.querySelector('.lightbox-next').addEventListener('click', showNext);

    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (!lightbox.classList.contains('active')) return;

      switch(e.key) {
        case 'Escape':
          closeLightbox();
          break;
        case 'ArrowLeft':
          showPrevious();
          break;
        case 'ArrowRight':
          showNext();
          break;
      }
    });

    // Load project details
    async function loadProject() {
      try {
        const response = await fetch('/data.json');
        if (!response.ok) {
          throw new Error('Failed to load portfolio data');
        }

        const data = await response.json();

        // Find project
        const project = data.projects.find(p => p.id === projectId && p.category === categoryName);
        if (!project) {
          throw new Error('Project not found');
        }

        // Update page
        document.getElementById('page-title').textContent = `${project.title} - Yarik's Portfolio`;
        document.getElementById('project-title').textContent = project.title;
        document.getElementById('project-description').textContent = project.description;

        // Load gallery
        const galleryGrid = document.getElementById('gallery-grid');

        if (project.images.length === 0) {
          galleryGrid.innerHTML = '<p class="error">No images available for this project</p>';
          return;
        }

        // Store images for lightbox (use URL directly - could be repo or release)
        currentImages = project.images.map(img => img.url);

        // Clear loading message
        galleryGrid.innerHTML = '';

        // Create gallery items
        project.images.forEach((image, index) => {
          const item = document.createElement('div');
          item.className = 'gallery-item fade-in';
          item.innerHTML = `<img src="${image.url}" alt="${project.title} - Image ${index + 1}" loading="lazy">`;

          // Handle image loading
          const img = item.querySelector('img');
          img.addEventListener('load', function() {
            this.classList.add('loaded');
          });
          img.addEventListener('error', function() {
            this.parentElement.style.display = 'none';
          });

          // Add click handler for lightbox
          item.addEventListener('click', () => openLightbox(index));

          galleryGrid.appendChild(item);
        });
      } catch (error) {
        console.error('Error loading project:', error);
        document.getElementById('gallery-grid').innerHTML = `
          <div class="error">
            <p>Failed to load project. Please try again later.</p>
            <p><small>${error.message}</small></p>
          </div>
        `;
      }
    }

    // Hide logo if it doesn't exist
    const logoImg = document.getElementById('logo-img');
    logoImg.addEventListener('error', () => {
      logoImg.style.display = 'none';
    });

    // Set current year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Initialize
    loadProject();
  </script>
</body>
</html>
