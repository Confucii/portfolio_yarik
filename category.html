<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Browse projects by category">
  <title id="page-title">Category - Yarik's Portfolio</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <!-- Header -->
  <header>
    <nav class="container">
      <div class="logo">
        <img src="/public/logo.svg" alt="Logo" id="logo-img">
        <span>Portfolio</span>
      </div>
      <button class="menu-toggle" aria-label="Toggle menu">â˜°</button>
      <ul class="nav-links">
        <li><a href="/">Home</a></li>
        <li><a href="/about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <!-- Category Header -->
  <section class="hero" style="min-height: 40vh;">
    <div class="container">
      <h1 id="category-title">Loading...</h1>
      <p id="category-description"></p>
    </div>
  </section>

  <!-- Projects Grid -->
  <section class="projects">
    <div class="container">
      <div class="project-grid" id="project-grid">
        <div class="loading">Loading projects...</div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; <span id="year"></span> Yarik. All rights reserved.</p>
    </div>
  </footer>

  <script type="module">
    // Mobile menu toggle
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('.nav-links');

    menuToggle.addEventListener('click', () => {
      navLinks.classList.toggle('active');
    });

    // Get category from URL
    const urlParams = new URLSearchParams(window.location.search);
    const categoryName = urlParams.get('name');

    if (!categoryName) {
      window.location.href = '/';
    }

    // Load projects for category
    async function loadProjects() {
      try {
        const response = await fetch('/data.json');
        if (!response.ok) {
          throw new Error('Failed to load portfolio data');
        }

        const data = await response.json();

        // Find category
        const category = data.categories.find(cat => cat.name === categoryName);
        if (!category) {
          throw new Error('Category not found');
        }

        // Update page title and header
        document.getElementById('page-title').textContent = `${category.displayName} - Yarik's Portfolio`;
        document.getElementById('category-title').textContent = category.displayName;
        document.getElementById('category-description').textContent = `${category.projectCount} ${category.projectCount === 1 ? 'project' : 'projects'}`;

        // Filter projects for this category
        const projects = data.projects.filter(project => project.category === categoryName);

        const projectGrid = document.getElementById('project-grid');

        if (projects.length === 0) {
          projectGrid.innerHTML = '<p class="error">No projects found in this category</p>';
          return;
        }

        // Clear loading message
        projectGrid.innerHTML = '';

        // Create project cards
        projects.forEach(project => {
          const card = document.createElement('a');
          card.href = `/project.html?id=${encodeURIComponent(project.id)}&category=${encodeURIComponent(categoryName)}`;
          card.className = 'project-card fade-in';

          // Get thumbnail or first image
          const thumbnail = project.thumbnail || (project.images.length > 0 ? project.images[0].path : '');

          card.innerHTML = `
            ${thumbnail ? `<img src="/${thumbnail}" alt="${project.title}" class="project-thumbnail" loading="lazy">` : '<div class="project-thumbnail" style="background: var(--color-bg);"></div>'}
            <div class="project-info">
              <h3>${project.title}</h3>
              <p>${project.description}</p>
            </div>
          `;

          // Handle image loading
          const img = card.querySelector('img');
          if (img) {
            img.addEventListener('load', function() {
              this.classList.add('loaded');
            });
            img.addEventListener('error', function() {
              this.style.display = 'none';
            });
          }

          projectGrid.appendChild(card);
        });
      } catch (error) {
        console.error('Error loading projects:', error);
        document.getElementById('project-grid').innerHTML = `
          <div class="error">
            <p>Failed to load projects. Please try again later.</p>
            <p><small>${error.message}</small></p>
          </div>
        `;
      }
    }

    // Hide logo if it doesn't exist
    const logoImg = document.getElementById('logo-img');
    logoImg.addEventListener('error', () => {
      logoImg.style.display = 'none';
    });

    // Set current year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Initialize
    loadProjects();
  </script>
</body>
</html>
